<div class="hero-form-container">
    <mat-card class="form-card">
        <mat-card-header>
            <mat-card-title>
                <mat-icon>{{isEditMode() ? 'edit' : 'add'}}</mat-icon>
            </mat-card-title>
            <h3>{{title()}}</h3>
        </mat-card-header>

        <mat-card-content class="hero-form-content">

            @if (isLoading()) {
            <div class="loading-container">
                <app-loading-spinner>
                </app-loading-spinner>
            </div>
            } @else {

            <form [formGroup]="heroForm" class="hero-form">

                <div class="form-section">
                    <h4>Datos</h4>

                    <div class="image-section">
                        <app-image-upload [currentImageUrl]="currentImageUrl" [isUploading]="imageUploading()"
                            (imageSelected)="onImageSelected($event)" (uploadingChange)="onImageUploading($event)">>
                        </app-image-upload>
                    </div>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Nombre</mat-label>
                        <input matInput formControlName="name" appUppercase placeholder="">
                        <mat-icon matPrefix>person</mat-icon>

                        @if (getHasError('name')) {
                        <mat-error>{{getErrorMessage('name')}}</mat-error>
                        }

                    </mat-form-field>

                </div>

                <div class="form-section">
                    <h4>Superpoderes</h4>

                    <!-- Add New Power Form -->
                    <div class="add-power-form">
                        <!-- Campo Nombre del Poder -->
                        <mat-form-field appearance="outline">
                            <mat-label>Nombre del Poder</mat-label>
                            <input matInput [formControl]="newPowerNameControl" placeholder="" maxlength="50">
                            <mat-icon matPrefix>flash_on</mat-icon>
                            @if (newPowerNameControl.invalid && newPowerNameControl.touched) {
                            <mat-error>El nombre del poder es requerido</mat-error>
                            }
                        </mat-form-field>

                        <!-- Campo Descripci贸n -->
                        <mat-form-field appearance="outline">
                            <mat-label>Descripci贸n</mat-label>
                            <input matInput [formControl]="newPowerDescControl" placeholder="" maxlength="100">
                            <mat-icon matPrefix>description</mat-icon>
                        </mat-form-field>

                        <button mat-raised-button color="primary" type="button" [disabled]="!newPowerNameControl.value"
                            (click)="addNewPower()">
                            <mat-icon>add</mat-icon>
                            Agregar
                        </button>

                    </div>
                </div>

                @if (powersTableData().length > 0) {
                <div class="powers-list">
                    <h5>Poderes agregados ({{ powersTableData().length }})</h5>

                    <table mat-table [dataSource]="powersTableData()" class="powers-table">
                        <ng-container matColumnDef="powerName">
                            <th mat-header-cell *matHeaderCellDef>Nombre del Poder</th>
                            <td mat-cell *matCellDef="let element">
                                <strong>{{ element.name }}</strong>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="powerDescription">
                            <th mat-header-cell *matHeaderCellDef>Descripci贸n</th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.description || 'Sin descripci贸n' }}
                            </td>
                        </ng-container>


                        <ng-container matColumnDef="powerActions">
                            <th mat-header-cell *matHeaderCellDef>Acciones</th>
                            <td mat-cell *matCellDef="let element">
                                <button mat-icon-button color="warn" (click)="removePower(element.index)">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </td>
                        </ng-container>


                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>
                </div>
                }

            </form>

            <mat-card-actions class="form-actions" align="end">
                <button mat-button color="warn" type="button" (click)="onCancel()">
                    <mat-icon>cancel</mat-icon>
                    Cancelar
                </button>
                <button mat-raised-button color="primary" type="submit" (click)="onSubmit()">
                    <mat-icon>{{ isEditMode() ? 'save' : 'add' }}</mat-icon>
                    {{ buttonText() }}
                </button>
            </mat-card-actions>


            }


        </mat-card-content>
    </mat-card>
</div>